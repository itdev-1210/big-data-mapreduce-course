<!DOCTYPE html>
<html lang="en">

<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="description"
	content="A series of tutorials where we are going to talk about various map reduce examples.">
<meta name="google-site-verification"
	content="Om-cWVyUrlqMRb9e2FlVKXGW7FKb3ExTZPGEYv2vaHo" />
<meta name="msvalidate.01" content="DB3E861A9822F0544996593E60551917" />
<meta name="keywords"
	content="hadoop, map reduce, advanced map reduce examples, map reduce counters">
<meta name="author" content="Tanmay Deshpande">
<meta property="og:site_name" content="HadoopTutorials.co.in" />
<meta property="og:type" content="article" />
<meta property="fb:page_id" content="928151523865265" />
<meta property="og:url"
	content="http://hadooptutorials.co.in/tutorials/mapreduce/advanced-map-reduce-examples-1.html" />
<meta property="og:title"
	content="Advanced Map Reduce Examples - Part 1" />
<meta property="og:image"
	content="http://hadooptutorials.co.in/images/map-reduce.jpg" />
<meta property="og:description"
	content="A series of tutorials where we are going to talk about various map reduce examples." />

<title>Advanced Map Reduce Examples by Tanmay Deshpande |
	hadooptutorials.co.in</title>

<!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
<link href="../../css/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="../../css/freelancer.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="../../font-awesome-4.1.0/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Montserrat:400,700"
	rel="stylesheet" type="text/css">
<link
	href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic"
	rel="stylesheet" type="text/css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

<script type="text/javascript"
	src="../../syntaxhighlighter/scripts/shCore.js"></script>
<script type="text/javascript"
	src="../../syntaxhighlighter/scripts/shBrushJava.js"></script>
<link type="text/css" rel="stylesheet"
	href="../../syntaxhighlighter/styles/shCoreDefault.css" />
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

<script>
	(function(i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function() {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o), m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', '//www.google-analytics.com/analytics.js',
			'ga');

	ga('create', 'UA-54510033-1', 'auto');
	ga('send', 'pageview');
</script>

<!-- CSS_ADSBLOCK_START -->
<link rel="stylesheet" href="http://adblockers.opera-mini.net/css_block/default-domainless.css" type="text/css" />
<!-- CSS_ADSBLOCK_END -->
</head>
<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript"
	src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-541ffefb590e6e0b"></script>

<body id="page-top" class="index">
	<div id="fb-root"></div>
	<script>
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id))
				return;
			js = d.createElement(s);
			js.id = id;
			js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&appId=358471830938421&version=v2.0";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
	</script>


	<!-- Navigation -->
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="../../index.html">Hadoop Tutorials</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li class="hidden"><a href="#page-top"></a></li>
					<li class="page-scroll"><a
						href="../../certifications/hadoop/hadoop-developer-certification-1-0.html">Free
							Certifications</a></li>
					<li class="page-scroll"><a
						href="../../free-online-hadoop-tutorials.html">Video Tutorials</a></li>

					<li class="page-scroll"><a href="../../about.html">About</a></li>
					<li class="page-scroll"><a href="../../contact.html">Contact</a></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container-fluid -->
	</nav>
	<br>
	<br>
	<!-- Header -->
	<header>
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="intro-text">
						<span class="name">Hadoop Tutorials.CO.IN</span>
						<hr class="star-light">
						<span class="skills">Big Data - Hadoop - Hadoop Ecosystem -
							NoSQL - Spark</span>
					</div>
				</div>
			</div>
		</div>
	</header>
	<div class="container">

		<div class="row">

			<!-- Blog Entries Column -->
			<div class="col-lg-8" align="justify">
				<h1 align="left">
					<a href="#">Advanced Map Reduce Examples - Part 1</a>
				</h1>

				<p class="lead">
					by <a href="mailto:tanmay.avinash.deshpande@gmail.com"> Tanmay
						Deshpande</a>
				</p>

				<p>In this series of articles, we are going to solve some real
					world problems with map reduce code on hadoop. Our first problem
					statement is</p>
				<br>
				<script type="text/javascript" language="javascript">
					var aax_size = '728x90';
					var aax_pubname = 'httphadooptut-21';
					var aax_src = '302';
				</script>
				<script type="text/javascript" language="javascript"
					src="http://c.amazon-adsystem.com/aax2/assoc.js"></script>
				<br>

				<p>XYZ.com is an online music website where users listen to
					various tracks, the data gets collected like shown below. Write a
					map reduce program to get following stats</p>
				<ul>
					<li>Number of unique listeners</li>
					<li>Number of times the track was shared with others</li>
					<li>Number of times the track was listened to on the radio</li>
					<li>Number of times the track was listened to in total</li>
					<li>Number of times the track was skipped on the radio</li>
				</ul>
				<p>The data is coming in log files and looks like as shown
					below.</p>
				<p>
					UserId|TrackId|Shared|Radio|Skip<br> 111115|222|0|1|0<br>
					111113|225|1|0|0<br> 111117|223|0|1|1<br>
					111115|225|1|0|0
				</p>
				<p>In this tutorial we are going to solve the first problem,
					that is finding out unique listeners per track.</p>
				<p>First of all we need to understand the data, here the first
					column is UserId and the second one is Track Id. So we need to
					write a mapper class which would emit trackId and userIds and
					intermediate key value pairs. To make it simple to remember the
					data sequence, let's create a constants class as shown below</p>
				<br>
				<script type="text/javascript" language="javascript">
					var aax_size = '728x90';
					var aax_pubname = 'httphadooptut-21';
					var aax_src = '302';
				</script>
				<script type="text/javascript" language="javascript"
					src="http://c.amazon-adsystem.com/aax2/assoc.js"></script>
				<br>


				<pre class="brush: java;  gutter:false;" width="600">public class LastFMConstants {

	public static final int USER_ID = 0;
	public static final int TRACK_ID = 1;
	public static final int IS_SHARED = 2;
	public static final int RADIO = 3;
	public static final int IS_SKIPPED = 4;
	
}
</pre>
				<p>Now, lets create the mapper class which would emit
					intermediate key value pairs as (TrackId, UserId) as shwon below</p>
				<pre class="brush: java;  gutter:false;" width="600"; >
public static class UniqueListenersMapper extends
Mapper< Object , Text, IntWritable, IntWritable > {
		IntWritable trackId = new IntWritable();
		IntWritable userId = new IntWritable();

public void map(Object key, Text value,
	Mapper< Object , Text, IntWritable, IntWritable > .Context context)
		throws IOException, InterruptedException {

	String[] parts = value.toString().split("[|]");
	trackId.set(Integer.parseInt(parts[LastFMConstants.TRACK_ID]));
	userId.set(Integer.parseInt(parts[LastFMConstants.USER_ID]));
		if (parts.length == 5) {
		context.write(trackId, userId);
	} else {
		// add counter for invalid records
		context.getCounter(COUNTERS.INVALID_RECORD_COUNT).increment(1L);
	}
	}
}
										</pre>
				<p>
					You would have also noticed that we are using a counter here named
					<code>INVALID_RECORD_COUNT</code>
					, to count if there are any invalid records which are not coming
					the expected format. Remember, if we don't do this then in case of
					invalid records, our program might fail.
				</p>
				<br>
				<div data-WRID="WRID-146754572385069022"
					data-widgetType="staticBanner" data-class="affiliateAdsByFlipkart"
					height="60" width="468"></div>
				<script async
					src="//affiliate.flipkart.com/affiliate/widgets/FKAffiliateWidgets.js"></script>
				<br>
				<p>Now let's write a Reducer class to aggregate the results.
					Here we simply can not use sum reducer as the records we are
					getting are not unique and we have to count only unique users. Here
					is how the code would look like</p>
				<pre class="brush: java;  gutter:false;" width="600";>
public static class UniqueListenersReducer extends
	Reducer< IntWritable , IntWritable, IntWritable, IntWritable> {
	public void reduce(
		IntWritable trackId,
		Iterable< IntWritable > userIds,
		Reducer< IntWritable , IntWritable, IntWritable, 
		IntWritable>.Context context)
		throws IOException, InterruptedException {
		Set< Integer > userIdSet = new HashSet< Integer >();
		for (IntWritable userId : userIds) {
		userIdSet.add(userId.get());
     	}
		IntWritable size = new IntWritable(userIdSet.size());
		context.write(trackId, size);
	}
}
										</pre>
				<p>Here we are using Set to eliminate duplicate userIds. Now we
					can take look at the Driver class</p>

				<br>
				<div data-WRID="WRID-146754572385069022"
					data-widgetType="staticBanner" data-class="affiliateAdsByFlipkart"
					height="60" width="468"></div>
				<script async
					src="//affiliate.flipkart.com/affiliate/widgets/FKAffiliateWidgets.js"></script>
				<br>
				<pre class="brush: java;  gutter:false;" width="600";>
public static void main(String[] args) throws Exception {
		Configuration conf = new Configuration();
		if (args.length != 2) {
			System.err.println("Usage: uniquelisteners < in > < out >");
			System.exit(2);
		}
		Job job = new Job(conf, "Unique listeners per track");
		job.setJarByClass(UniqueListeners.class);
		job.setMapperClass(UniqueListenersMapper.class);
		job.setReducerClass(UniqueListenersReducer.class);
		job.setOutputKeyClass(IntWritable.class);
		job.setOutputValueClass(IntWritable.class);
		FileInputFormat.addInputPath(job, new Path(args[0]));
		FileOutputFormat.setOutputPath(job, new Path(args[1]));
		System.exit(job.waitForCompletion(true) ? 0 : 1);
		org.apache.hadoop.mapreduce.Counters counters = job.getCounters();
		System.out.println("No. of Invalid Records :"
				+ counters.findCounter(COUNTERS.INVALID_RECORD_COUNT)
						.getValue());
	}

</pre>

				<br>
				<script type="text/javascript" language="javascript">
					var aax_size = '728x90';
					var aax_pubname = 'httphadooptut-21';
					var aax_src = '302';
				</script>
				<script type="text/javascript" language="javascript"
					src="http://c.amazon-adsystem.com/aax2/assoc.js"></script>
				<br>
				<p>
					Now just export this code as jar and execute it in your Hadoop
					environment. In case you need to see the complete code, you take a
					look at it as this GitHub <a
						href="https://github.com/deshpandetanmay/mapreduce-examples/blob/master/trunk/lastfm-examples/src/fm/last/stats/UniqueListeners.java">Repo</a>
				</p>
				<p>Feel free to use, download or fork this repo to solve the
					remaining problems as well.</p>
				<input type="hidden" name="IL_IN_ARTICLE">

				<div class="fb-comments"
					data-href="http://hadooptutorials.co.in/tutorials/mapreduce/advanced-map-reduce-examples-1.html"
					data-numposts="10" data-colorscheme="light" data-width="600"></div>

			</div>


			<br> <br>
			<!-- Blog Sidebar Widgets Column -->
			<div class="col-md-4">

				<!-- Blog Search Well -->
				<div class="well">
					<h4>Search</h4>
					<script>
						(function() {
							var cx = '010328834231779619215:ehmcw9n8uxi';
							var gcse = document.createElement('script');
							gcse.type = 'text/javascript';
							gcse.async = true;
							gcse.src = (document.location.protocol == 'https:' ? 'https:'
									: 'http:')
									+ '//www.google.com/cse/cse.js?cx=' + cx;
							var s = document.getElementsByTagName('script')[0];
							s.parentNode.insertBefore(gcse, s);
						})();
					</script>
					<gcse:search></gcse:search>
					<!-- /.input-group -->
				</div>

				<!-- Blog Categories Well -->
				<div class="well">
					<h4>Hadoop Real World Solutions Cookbook - Second Edition</h4>
					<a href="http://amzn.to/29gd13v"><img class="img-responsive"
						src="images/HadoopSolutions.PNG"
						alt="Hadoop Real World Solutions - Second Edition"> </a> <br>
					<br>

					<h4>Blog Categories</h4>
					<div class="row">
						<div class="list-group panel">
							<a href="#hadoop" class="list-group-item list-group-item-success"
								data-toggle="collapse" data-parent="#ops-nav">Hadoop</a>
							<div class="collapse" id="hadoop">
								<a class="list-group-item"
									href="../../tutorials/hadoop/install-hadoop-on-ubuntu.html">Install
									Hadoop on Ubuntu - A Quick Start guide</a> <a
									class="list-group-item"
									href="../../tutorials/hadoop/hadoop-fundamentals.html">
									Hadoop Fundamentals</a> <a class="list-group-item"
									href="../../tutorials/hadoop/internals-of-hdfs-file-read-operations.html">
									Internals of HDFS File Read Operations</a> <a
									class="list-group-item"
									href="../../tutorials/hadoop/understanding-map-reduce-programming.html">
									Understanding Map Reduce Programming</a> <a class="list-group-item"
									href="../../tutorials/hadoop/understanding-hadoop-ecosystem.html">
									Understanding Hadoop Ecosytem</a> <a class="list-group-item"
									href="../../tutorials/mapreduce/advanced-map-reduce-examples-1.html">
									Advanced Map Reduce Examples - Part 1</a> <a
									class="list-group-item"
									href="../../tutorials/mapreduce/advanced-map-reduce-examples-2.html">
									Advanced Map Reduce Examples - Part 2</a><a class="list-group-item"
									href="../../tutorials/hadoop/hadoop-skills-club-an-exclusive-insight.html">
									Hadoop skills club an exclusive insight</a>


							</div>

							<div>
								<a href="#bigdata"
									class="list-group-item list-group-item-success"
									data-toggle="collapse" data-parent="#ops-nav">Big Data</a>
								<div class="collapse" id="bigdata">
									<a class="list-group-item"
										href="../../tutorials/hadoop/big-data-analytics-what-is-that.html">
										Big Data Analytics - What is that ?</a>
								</div>

								<div>
									<a href="#hive" class="list-group-item list-group-item-success"
										data-toggle="collapse" data-parent="#ops-nav">Hive</a>
									<div class="collapse" id="hive">
										<a class="list-group-item"
											href="../../tutorials/hive/introduction-to-apache-hive.html">
											Introduction to Apache Hive</a> <a class="list-group-item"
											href="../../tutorials/hive/hive-data-units.html"> Data
											Units in Apache Hive</a> <a class="list-group-item"
											href="../../tutorials/hive/hive-best-practices.html">
											Best Practices in Apache Hive</a>
									</div>

									<a href="#sqoop"
										class="list-group-item list-group-item-success"
										data-toggle="collapse" data-parent="#ops-nav">Sqoop</a>
									<div class="collapse" id="sqoop">
										<a class="list-group-item"
											href="../../tutorials/sqoop/introduction-to-apache-sqoop.html">
											Introduction to Apache Sqoop</a> <a class="list-group-item"
											href="../../tutorials/sqoop/apache-sqoop-advanced-features.html">
											Apache Sqoop - Advanced Features</a>
									</div>

									<a href="#spark"
										class="list-group-item list-group-item-success"
										data-toggle="collapse" data-parent="#ops-nav">Spark</a>
									<div class="collapse" id="spark">
										<a class="list-group-item"
											href="../../tutorials/spark/install-apache-spark-on-ubuntu.html">
											Installing Apache Spark on Ubuntu</a>
									</div>
									<a href="#elasticsearch"
										class="list-group-item list-group-item-success"
										data-toggle="collapse" data-parent="#ops-nav">Elasticsearch</a>
									<div class="collapse" id="elasticsearch">
										<a class="list-group-item"
											href="../../tutorials/elasticsearch/install-elasticsearch-kibana-logstash-on-windows.html">
											Install Elasticsearch, Logstash and Kibana to do log
											analytics</a><a class="list-group-item"
											href="../../tutorials/elasticsearch/log-analytics-using-elasticsearch-logstash-kibana.html">
											Log Analytics using Elasticsearch, Logstash and Kibana</a> <a
											class="list-group-item"
											href="../../tutorials/elasticsearch/real-time-alerting-using-elasticsearch-watcher.html">
											Real-Time Alerting using Using ElasticSearch Watcher</a>
									</div>

								</div>
							</div>
						</div>


					</div>
					<!-- /.row -->
				</div>
				<!-- Blog Categories Well -->
				<div class="well">
					<h4>Free Certification</h4>
					<div class="row">
						<div class="list-group panel">

							<a class="list-group-item list-group-item-success"
								href="../../certifications/hadoop/hadoop-developer-certification-1-0.html">Hadoop
								Developer Certification 1.0</a> <a
								class="list-group-item list-group-item-success"
								href="../../certifications/hive/apache-hive-certification-1-0.html">Hive
								Developer Certification 1.0</a>
						</div>

					</div>
				</div>
				<!-- Side Widget Well -->
				<div class="well">
					<h4>Follow us on Twitter</h4>
					<a class="twitter-timeline"
						href="https://twitter.com/HadoopTutorials"
						data-widget-id="513916181426618368">Tweets by @HadoopTutorials</a>
					<script>
						!function(d, s, id) {
							var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/
									.test(d.location) ? 'http' : 'https';
							if (!d.getElementById(id)) {
								js = d.createElement(s);
								js.id = id;
								js.src = p
										+ "://platform.twitter.com/widgets.js";
								fjs.parentNode.insertBefore(js, fjs);
							}
						}(document, "script", "twitter-wjs");
					</script>

				</div>
				<div class="well">
					<h4>Recommended for you</h4>
					<!-- Go to www.addthis.com/dashboard to customize your tools -->
					<div class="addthis_recommended_vertical"></div>
					<script async
						src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

				</div>
				<div class="well">
					<SCRIPT charset="utf-8" type="text/javascript"
						src="http://ws-in.amazon-adsystem.com/widgets/q?rt=tf_ssw&ServiceVersion=20070822&MarketPlace=IN&ID=V20070822%2FIN%2Fhttphadooptut-21%2F8003%2F59813b32-38a1-4551-940f-8e5c97db3d4f&Operation=GetScriptTemplate">
						
					</SCRIPT>
					<NOSCRIPT>
						<A rel="nofollow"
							HREF="http://ws-in.amazon-adsystem.com/widgets/q?rt=tf_ssw&ServiceVersion=20070822&MarketPlace=IN&ID=V20070822%2FIN%2Fhttphadooptut-21%2F8003%2F59813b32-38a1-4551-940f-8e5c97db3d4f&Operation=NoScript">Amazon.in
							Widgets</A>
					</NOSCRIPT>
					<br>
					<div data-WRID="WRID-146754581330547823"
						data-widgetType="staticBanner" data-responsive="yes"
						data-class="affiliateAdsByFlipkart" height="250" width="300"></div>
					<script async
						src="//affiliate.flipkart.com/affiliate/widgets/FKAffiliateWidgets.js"></script>

				</div>


			</div>

		</div>
		<!-- /.row -->

		<hr>


	</div>
	<footer class="text-center">
		<div class="footer-above">
			<div class="container">
				<div class="row">
					<div class="footer-col col-md-4">
						<h3>Want to write for us ?</h3>
						<p>
							Send in your articles today @<a
								href="mailto:hadooptutorialsindia@gmail.com ">HadooTutorials.co.in</a>
						</p>
					</div>
					<div class="footer-col col-md-4">
						<h3>Around the Web</h3>
						<ul class="list-inline">
							<li><a href="https://www.facebook.com/hadooptutorialscoin"
								class="btn-social btn-outline"><i
									class="fa fa-fw fa-facebook"></i></a></li>
							<li><a href="mailto:hadooptutorialsindia@gmail.com"
								class="btn-social btn-outline"><i
									class="fa fa-fw fa-google-plus"></i></a></li>
							<li><a href="https://twitter.com/HadoopTutorials"
								class="btn-social btn-outline"><i
									class="fa fa-fw fa-twitter"></i></a></li>
							<li><a href="http://in.linkedin.com/in/deshpandetanmay"
								class="btn-social btn-outline"><i
									class="fa fa-fw fa-linkedin"></i></a></li>

						</ul>
					</div>
					<div class="footer-col col-md-4">
						<h3>About Us</h3>
						<p>HadoopTutorials.co.in is a website which offers simple to
							advance, easy to understand articles and tutorials.</p>
					</div>
				</div>
				<div class="row">
					<div class="footer-col col-md-12">
						<h3>Disclaimer</h3>
						<p>
							Apache Hadoop, Hadoop, Hadoop Elephant Logo, Hive, Pig, Sqoop,
							Zookeeper and Apache are either registered trademarks or
							trademarks of the <a href="http://www.apache.org/">Apache
								Software Foundation</a> in the United States and/or other countries,
							and are used with <a
								href="http://www.apache.org/foundation/marks/domains.html">permission</a>
							as of 2015. The Apache Software Foundation has no affiliation
							with and does not endorse or review the materials provided at
							this website.
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="footer-below">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						Copyright &copy; HadoopTutorials.co.in | <a
							href="../../privacy.html">Privacy Policy</a> | <a
							href="../../terms-of-service.html">Terms of Service</a>
					</div>
				</div>
			</div>
		</div>

	</footer>

	<!-- jQuery -->
	<script src="../../js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../../js/bootstrap.min.js"></script>

	<!-- Plugin JavaScript -->
	<script
		src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
	<script src="../../js/classie.js"></script>
	<script src="../../js/cbpAnimatedHeader.js"></script>

	<!-- Contact Form JavaScript -->
	<script src="../../js/jqBootstrapValidation.js"></script>
	<script src="../../js/contact_me.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="../../js/freelancer.js"></script>
	<script type="text/javascript">
		var infolinks_pid = 2883022;
		var infolinks_wsid = 0;
	</script>
	<script type="text/javascript"
		src="//resources.infolinks.com/js/infolinks_main.js"></script>
</body>

</html>
